package me.alek.serversecurity.malware.obfuscation.impl;

import me.alek.serversecurity.malware.checks.ObfuscationCheck;
import me.alek.serversecurity.malware.model.AttributeStatus;
import me.alek.serversecurity.malware.enums.Risk;
import me.alek.serversecurity.utils.ZipUtils;

public abstract class AbstractLengthBasedObfFeature extends AbstractObfFeature {

    public String fixClass(String classPath) {
        return ZipUtils.getRootClass(classPath);
    }

    @Override
    public boolean feedback(AttributeStatus attributeStatusModel) {
        return attributeStatusModel.generatePercentage() > 0.6;
    }

    @Override
    public Risk getFeatureRisk() {
        return Risk.LOW;
    }

    public void affectAttributeStatus(AttributeStatus attributeStatusModel, String string) {
        boolean shouldFlag = false;
        if (string.length() <= 3) {
            boolean isAcceptedName = false;
            for (String nameCheck : ObfuscationCheck.acceptedNameObfContainer.getList()) {
                if (string.equalsIgnoreCase(nameCheck)) {
                    isAcceptedName = true;
                    break;
                }
            }
            shouldFlag = !isAcceptedName;
        }
        affectAttributeStatusGlobally(attributeStatusModel, shouldFlag);
    }
}
