package me.alek.antimalware.malware.obfuscation.impl.fields;

import me.alek.antimalware.malware.model.AttributeStatus;
import me.alek.antimalware.malware.enums.Risk;
import me.alek.antimalware.malware.obfuscation.impl.AbstractFieldObfFeature;
import me.alek.antimalware.malware.obfuscation.impl.AbstractObfFeature;
import org.objectweb.asm.tree.FieldNode;

import java.util.regex.Pattern;

public class FieldCharSpecialFeature extends AbstractObfFeature implements AbstractFieldObfFeature {

    private final Pattern regexPattern;

    public FieldCharSpecialFeature() {
        this.regexPattern = Pattern.compile("[A-Za-z0-9_\\$]");
    }

    @Override
    public void affectAttributeStatus(AttributeStatus attributeStatusModel, FieldNode field) {
        String fieldName = field.name;

        affectAttributeStatusGlobally(attributeStatusModel, !regexPattern.matcher(fieldName).find());
    }

    @Override
    public Risk getFeatureRisk() {
        return Risk.HIGH;
    }

    @Override
    public String getName() {
        return "Field Special Char";
    }

    @Override
    public boolean feedback(AttributeStatus attributeStatusModel) {
        return attributeStatusModel.getAbnormalCount() >= 1;
    }


}
